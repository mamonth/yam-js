define("yam/Logger",["jquery-class"],function(a){"use strict";var b=function(){},c="undefined"!=typeof navigator&&-1!=navigator.userAgent.indexOf("MSIE"),d=console?console:{log:b,debug:b,info:b,warn:b,error:b};return a.extend("yam.Logger",{NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4,LOG:5,level:1,log:function(){this.level>=this.LOG&&this._echo(arguments,"log")},debug:function(){this.level>=this.DEBUG&&this._echo(arguments,"debug")},info:function(){this.level>=this.INFO&&this._echo(arguments,"info")},warn:function(){this.level>=this.WARN&&this._echo(arguments,"warn")},error:function(){this.level>=this.ERROR&&this._echo(arguments,"error")},_parseArgs:function(){var a=Array.prototype.slice.call(arguments[0]),b=a[0]instanceof jQuery.Class;return[b?"["+a[0].constructor.fullName+"]":a[0]].concat(a.slice(1))},_echo:function(a,b){var a=Logger._parseArgs(a);c?d[b](a.join(" ")):d[b].apply(console,a)}},{})}),define("yam/Hub",["jquery","jquery-class","yam/Logger"],function(a,b,c){"use strict";return b.extend("yam.Hub",{_nSpace:".yam",_domNode:a("<i/>"),stack:{},channels:{},pub:function(a,b,d){b=b||{},d=d===!0?!0:!1,"undefined"==typeof this.stack[a]&&(this.stack[a]=[]),this.channels[a]||d?this._pub(a,b):(this.stack[a].push(b),c.warn(this,'Push channel "'+a+'" to stack',b))},_pub:function(a,b){c.info(this,'Publish to channel "'+a+'"',b),this._domNode.trigger.apply(this._domNode,arguments)},sub:function(b,d){function e(a,b){return d.call(this,b,a)}if(this.channels[b]=!0,c.info(this,'Subscribed to channel "'+b+'"'),e.guid=d.guid=d.guid||(a.guid?a.guid++:a.event.guid++),this._domNode.bind(b+this._nSpace,e),this.stack[b]){for(var f in this.stack[b])c.warn(this,'get channel "'+b+'" from stack',f,this.stack[b]),this._pub(b,this.stack[b][f]);delete this.stack[b]}},unsub:function(a,b){c.info(this,'Unsubscribed from channel "'+a+'"'),void 0===b?this._domNode.unbind(a+this._nSpace):"function"==typeof b?this._domNode.unbind(a+this._nSpace,b):"object"==typeof b&&void 0!==b.type&&this._domNode.unbind(b)}},{})}),define("yam/State",["jquery","jquery-class"],function(a,b){"use strict";return b.extend("yam.State",{_stack:[],_currentKey:0,current:function(){var a;return a=void 0!==this._stack[this._currentKey]?this._stack[this._currentKey]:new this},push:function(b,c,d){var e=b instanceof this?b:new this(b,c,d);this._stack.length&&this._currentKey++,this._stack.splice(this._currentKey),this._stack.push(e),a(this).trigger("locationChange",e).trigger("push",e)},replace:function(b,c,d){var e=b instanceof this?b:new this(b,c,d);this._stack[this._currentKey]=e,a(this).trigger("locationChange",e).trigger("replace",e)},back:function(b){b=!b||isNaN(b)?1:Math.min(b,this._currentKey),this._currentKey&&(this._currentKey=this._currentKey-b,a(this).trigger("locationChange",this.current()).trigger("back",this.current()))},forward:function(b){b=!b||isNaN(b)?1:Math.min(b,this._stack.length-(this._currentKey+1)),this._currentKey<this._stack.length&&(this._currentKey=this._currentKey+b,a(this).trigger("locationChange",this.current()),a(this).trigger("forward",this.current()))}},{location:"",title:"",data:null,init:function(a,b,c){this.location=a,this.data=b||{},this.title=c||""}}),yam.State}),define("yam/Router",["jquery","jquery-class","yam/Logger","yam/State"],function(a,b,c,d){"use strict";return b.extend("yam.Route",{_rules:[],add:function(a,b){this._rules.push(new this(a,b))},match:function(a){a||(a=d.current().location);for(var b={},c=this._rules.length,e=0;c>e;e++)if(void 0===b[this._rules[e].name]){var f=this._rules[e].match(a);f!==!1&&(b[this._rules[e].name]=f)}return b},getParams:function(){for(var a,b={},c=this.getParamsString().split("&"),d=c.length;d--;)if(c[d]&&(a=c[d].split("="),a[0])){var e=a[0].indexOf("["),f=a[0].indexOf("]");if(e>0&&f>0){var g=a[0].substr(0,e);if("]"==a[0].charAt(e+1))b[g]||(b[g]=[]),b[g].push(a[1]);else{b[g]||(b[g]={});var h=a[0].substr(e+1,f-e-1);b[g][h]=a[1]}}else b[a[0]]=a[1]||""}return b},getParamsString:function(){var a=window.History.getState().url,b=a.indexOf("?");return b>0&&b+1<a.length?a.slice(b+1):""},extractChunkURI:function(a){var b=d.current().location,c=void 0;if(!isNaN(a)&&"string"==typeof b&&b.length>0&&b.indexOf("/")>=0){var e=b.split("/");e.length>=parseInt(a)&&(c=e[parseInt(a)])}return c},buildParamsString:function(b,c,d){var e=[],f=/\[\]$/,g=/%20/g,h=function(a,b){return b?a:encodeURIComponent(a)},i=function(b,c,d){a.isFunction(c)||(("undefined"==typeof c||null===c)&&(c=""),e[e.length]=h(b,d)+"="+h(c))},j=function(a,b,c,e,g){if(jQuery.isArray(b))b.forEach(function(b,i){c||f.test(a)?e(a,b):j(h(a,g)+"["+(d||"object"!=typeof b&&!jQuery.isArray(b)?"":i)+"]",b,c,e,!0)});else if(null!==b&&"object"==typeof b)for(var i in b){if(i.match(/jQuery[0-9]+/gi))return;j(h(a,g)+"["+h(i)+"]",b[i],c,e,!0)}else e(a,b,g)};if(void 0===c&&(c=a.ajaxSettings.traditional),a.isArray(b)||b.jquery&&!a.isPlainObject(b))a.each(b,function(){i(this.name,this.value)});else for(var k in b)j(k,b[k],c,i);return e.join("&").replace(g,"+")}},{name:null,rule:null,init:function(a,b){this.name=b,this.rule=a},match:function(a){var b,c,d=!1;if(this.rule instanceof RegExp){if(b=this.rule.exec(a))for(d=[],c=1;c<=b.length;c++)void 0!==b[c]&&d.push(b[c])}else a==this.rule&&(d=[]);return d}})}),define("yam/Observable",["jquery-class"],function(a){"use strict";return a.extend("app.Observable",{_attachedObservers:{},attachObserver:function(a,b){arguments.length<2&&(b=a,a="**WILDCARD**"),(b instanceof Object||b instanceof Function)&&(this._attachedObservers[a]||(this._attachedObservers[a]=[]),this._attachedObservers[a].push(b))},detachObserver:function(a,b){arguments.length<2&&(b=a,a=null);for(var c in this._attachedObservers)if(null===a||c===a)for(var d=this._attachedObservers[c].length;d--;)this._attachedObservers[c][d]===b&&this._attachedObservers[c].splice(d,1)},notify:function(a){if(this._attachedObservers[a]&&this._attachedObservers[a].length){for(var b=this._attachedObservers[a].length;b--;)this._notifyObserver(a,this._attachedObservers[i]);for(b=this._attachedObservers["**WILDCARD**"].length;b--;)this._notifyObserver(a,this._attachedObservers[i])}},_notifyObserver:function(a,b){b instanceof Function?b(a,this):b.update instanceof Function&&b.update(a,this)}})}),define("yam/AModel",["yam/Observable"],function(a){"use strict";return a.extend("yam.AModel",{properties:[],setup:function(a,b,c,d){for(var e in d)this._createGetSetFor(e)},getIdentity:function(){return"id"},get:function(){var a=$.Deferred();return a.promise()},getList:function(){var a=$.Deferred();return a.promise()},_getMethodEnding:function(a){return a.charAt(0).toUpperCase()+a.substr(1,a.length-1)},_createGetSetFor:function(a){if("function"!=typeof this.prototype[a]&&"_"!=a.charAt(0)){var b=this._getMethodEnding(a);void 0===this.prototype["get"+b]&&(this.prototype["get"+b]=function(){return this[a]}),void 0===this.prototype["set"+b]&&(this.prototype["set"+b]=function(b){return this._set(a,b)}),this.properties.push(a)}},factory:function(a){var b=new this;return a instanceof Object&&b.fill(a),b}},{id:void 0,_modifiedProperties:void 0,init:function(a){this.fill(a)},fill:function(a){for(var b in a){var c="set"+this.constructor._getMethodEnding(b);void 0!==this[c]&&"function"==typeof this[c]&&this[c](a[b])}},getIdentityValue:function(){return void 0!==this[this.constructor.getIdentity()]?this[this.constructor.getIdentity()]:void 0},_triggerProperty:function(a,b,c){$([this]).triggerHandler("propertyChange",{path:a,value:b,oldValue:c})},_set:function(a,b){var c=this[a];return this[a]=b,void 0!==c&&(this._modifiedProperties instanceof Array?this._modifiedProperties.push(a):this._modifiedProperties=[a]),this._triggerProperty(a,b,c),!0},getModifiedProperties:function(){return this._modifiedProperties instanceof Array?this._modifiedProperties:[]},propertiesData:function(){for(var a,b={},c=this.constructor.properties.length;c>=0;--c)a=this.constructor.properties[c],void 0!==a&&this.hasOwnProperty(a)&&(b[a]=this[a]);return b}})}),define("yam/AWatchedModel",["yam/Observable","yam/ModelWatcher","yam/ModelList","yam/AModel"],function(a,b,c,d){"use strict";return d.extend("yam.AWatchedModel",{create:function(a){return a instanceof Object&&void 0!==a.id?app.ModelWatcher.has(this,a.id)?app.ModelWatcher.get(this,a.id):new this(a):void 0},update:function(a){if(a instanceof Object&&void 0!==a.id&&app.ModelWatcher.has(this,a.id)){var b=app.ModelWatcher.get(this,a.id);for(var c in a){var d="set"+b.constructor._getMethodEnding(c);void 0!==b[d]&&"function"==typeof b[d]&&b[d](a[c])}}},factory:function(a){var b=app.ModelWatcher.has(this,a.id)?app.ModelWatcher.get(this,a.id):new this;return a instanceof Object&&b.fill(a),b}},{init:function(a){this._super(a),void 0!==this[this.constructor.getIdentity()]&&app.ModelWatcher.register(this)}})}),define("yam/ModelList",["yam/Observable"],function(a){"use strict";return a.extend("yam.ModelList",{_classDef:void 0,_collection:void 0,length:0,_proxyed:void 0,init:function(a,b){if(this._classDef=a,this._collection=[],this._proxyed={},this._proxyed.ojectChange=this.proxy(function(a,b){return a.stopPropagation(),$([this,this._collection]).triggerHandler("objectChange",$.extend(b,{targetModel:a.target})),!1}),void 0!==b&&b instanceof Array)for(var c=b.length,d=0;c>d;d++)b[d]instanceof app.AModel?this.push(b[d]):b[d]instanceof Object&&!(b[d]instanceof app.AModel)&&this.push(void 0!==this._classDef.create?this._classDef.create(b[d]):new this._classDef(b[d]))},push:function(a){this._collection.push(a),$([a]).bind("propertyChange",this._proxyed.ojectChange),this.length++,this._trigger({change:"insert",index:this._collection.length-1,items:[a]})},unshift:function(a){this._collection.unshift(a),$([a]).bind("propertyChange",this._proxyed.ojectChange),this.length++,this._trigger({change:"insert",index:0,items:[a]})},pop:function(){var a=this._collection.length-1,b=this._collection[a];return this._collection.splice(a,1),this.length=this._collection.length,this._trigger({change:"remove",index:a,items:[b]}),$([b]).unbind("propertyChange",this._proxyed.ojectChange),b},last:function(){return this._collection[this._collection.length-1]},getById:function(a){var b=this._getKeyBy(this._classDef.getIdentity(),a);return b.length?this._collection[b[0]]:null},get:function(a){return this._collection[a]},getIds:function(){for(var a=this._collection.length,b=[];a--;)b.push(this._collection[a][this._classDef.getIdentity()]);return b},remove:function(a){var b=this._getKeyBy(a.constructor.getIdentity(),a.getIdentityValue()),c=b.length;if(c)for(;c--;)this._collection.splice(b[c],1),this._trigger({change:"remove",index:b[c],items:[a]}),this.length--;return $([a]).unbind("propertyChange",this._proxyed.ojectChange),c},splice:function(a,b){b=b||this.length;var c=a>0?a-1:this._collection.length-b,d=this._collection.splice(a,b);this.length=this._collection.length,this._trigger({change:"remove",index:c,items:d})},filterBy:function(a,b){for(var c=this._getKeyBy(a,b),d=c.length,e=new this.constructor(this._classDef),f=0;d>f;f++)e.push(this._collection[d]);return e},each:function(a){if("function"!=typeof a)throw new Error("Invalid argument: callback must be a function");for(var b=this._collection.length,c=0;b>c;c++)a(this._collection[c])},_getKeyBy:function(a,b){for(var c=this._collection.length,d=[],e=0;c>e;e++)void 0!==this._collection[e]&&void 0!==this._collection[e][a]&&this._collection[e][a]===b&&d.push(e);return d},_trigger:function(a){$([this._collection]).triggerHandler("arrayChange",a)},getArray:function(){return this._collection},clear:function(){this._collection.length>0&&$(this._collection).unbind("propertyChange",this._proxyed.ojectChange),this._collection.length=0,this.length=this._collection.length,this._trigger({change:"remove",items:this._collection})}})}),define("yam/ModelWatcher",["jquery-class","yam/AModel"],function(a,b){"use strict";window.InvalidArgumentException=function(a){this.message=a||""},window.InvalidArgumentException.prototype=new Error,window.InvalidArgumentException.prototype.constructor=window.InvalidArgumentException,window.InvalidArgumentException.prototype.name="InvalidArgumentException",a.extend("yam.ModelWatcher",{_storage:{},register:function(a){if(!(a instanceof b)||void 0===a.constructor.fullName)throw new InvalidArgumentException(this.fullName+" can handle only yam.AModel instances");var c=a.getIdentityValue();if(this.has(a.constructor,c))throw new Error(a.constructor.fullName+" instance with identity "+c+" already registered");void 0===this._storage[a.constructor.fullName]&&(this._storage[a.constructor.fullName]={}),this._storage[a.constructor.fullName][c]=a},has:function(a,b){if(void 0===a.fullName)throw new InvalidArgumentException(this.fullName+" can handle only classes inherited from yam.AModel ");return!(void 0===this._storage[a.fullName]||void 0===this._storage[a.fullName][b])},get:function(a,b){if(void 0===a.fullName)throw new InvalidArgumentException(this.fullName+" can handle only classes inherited from app.AModel.");return this.has(a,b)?this._storage[a.fullName][b]:void 0},getList:function(a,b){var c=new app.ModelList(a);if(b instanceof Array&&b.length>0)for(var d in b){var e=this.get(a,b[d]);void 0!==e&&c.push(e)}else if(void 0===b&&this._storage[a.fullName]instanceof Object)for(var f in this._storage[a.fullName])this._storage[a.fullName].hasOwnProperty(f)&&"function"!=typeof this._storage[a.fullName][f]&&this._storage[a.fullName][f]instanceof Object&&c.push(this._storage[a.fullName][f]);return c},unregister:function(a){if(!this.has(a.constructor,a.getIdentityValue()))throw new InvalidArgumentException("Model "+a.constructor.fullName+" with id "+a.getIdentityValue()+" was not registered.");var b={};for(var c in this._storage[a.constructor.fullName])c!=a.getIdentityValue()&&(b[c]=this._storage[a.constructor.fullName][c]);this._storage[a.constructor.fullName]=b}},{})}),define("yam/IModule",["jquery-class"],function(a){"use strict";return a.extend("yam.IModule",{init:function(){},run:function(){throw new Error(this.constructor.fullName+": method run must be implemented.")},destruct:function(){throw new Error(this.constructor.fullName+": method destruct must be implemented")}})}),define("yam/ADeferredModule",["yam/IModule"],function(a){"use strict";return a.extend("yam.ADeferredModule",{_readyCallbacks:null,setup:function(){this._readyCallbacks=[]},onReady:function(a,b){if(b=void 0===b?!0:b,"function"!=typeof a)throw new Error("callback must be function");this._readyCallbacks.push({runOnce:b,callback:a})},setReady:function(){for(var a=this._readyCallbacks.length;a--;)void 0!==this._readyCallbacks[a].callback&&"function"==typeof this._readyCallbacks[a].callback&&this._readyCallbacks[a].callback(),this._readyCallbacks[a].runOnce!==!1&&this._readyCallbacks.splice(a,1)}})}),define("yam/I18n",["yam/Logger"],function(){"use strict";var a=function(b,c,d){return d=d||!1,c=app.I18n.get(b,c,!1),d?a.ucfirst(c):c};return a.storage={},a.dictMonths=["january","february","march","april","may","june","july","august","september","october","november","december"],a.dictDays=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],a.register=function(a,b){this.storage[a]=b},a.ucfirst=function(a){var b=a.charAt(0).toUpperCase();return b+a.substr(1,a.length-1)},a.monthByNum=function(b){return b>a.dictMonths.length-1?!1:a.dictMonths[b]},a.dayByNum=function(b){return b>a.dictDays.length-1?!1:a.dictDays[b]},a.formByNum=function(b,c,d){d=a._get(c,d,!0);var e=[2,0,1,1,1,2],f=b%100,g=Math.min(f>4&&20>f?2:e[Math.min(f%10,5)],d.length-1);return d[g]},a.getForm=function(b,c,d){return c=a._get(b,c,!0),c[Math.min(d,c.length)]},a._get=function(b,c,d){d=d||!1;var e=c+"";return void 0!==a.storage[b]&&void 0!==a.storage[b][c]&&(e=a.storage[b][c]),!d||e instanceof Array||(e=[e]),!d&&e instanceof Array&&(e=e.length?e[0]:c),e},a.get=function(b,c){var d=c+"";if(void 0!==a.storage[b]&&void 0!==a.storage[b][c]&&(d=a.storage[b][c]),d){var e=Array.prototype.slice.call(arguments).splice(2);e.unshift(d),d=a.format.apply(a,e)}return d},a.format=function(b){var c=Array.prototype.slice.call(arguments).splice(1),b="undefined"!=typeof b.substring?b:"";return b=b.replace(/{%(\d+)}/g,function(a,b){return b--,"undefined"!=typeof c[b]?c[b]:a}),b=b.replace(/\[(\w+)(:([^\]]+))?\]/g,function(b,d,e,f){var f=f?f.split("|"):[],g="_"+d+"Tag",h=!1;if("function"!=typeof a[g])throw new Error('Unsupported tag"'+d+'"');return h=a[g](c[0],f),h?h:""})},a._countTag=function(a,b){var c=[2,0,1,1,1,2],d=a%100,e=Math.min(d>4&&20>d?2:c[Math.min(d%10,5)],b.length-1);return b[e]},a}),define("yam/Core",["jquery","jquery-class","yam/Router","yam/State","yam/Logger","yam/ADeferredModule"],function(a,b,c,d,e,f){"use strict";return b.extend("yam.Core",{_instance:void 0,_readyCallbacks:[],getInstance:function(a){return this._instance||(this._instance=new this(a)),this._instance},ready:function(b,c){"function"==typeof b&&(c=b,b=void 0);var d=a.Deferred(),e=function(){d.resolve(this),"function"==typeof c&&c(this)};return this.getInstance()._ready?a(b).whenReady(e):this._readyCallbacks.push({selector:b,callback:e}),d.promise()}},{options:{routes:{},baseNamespace:"App"},_modules:{},_modulesToReady:{},_ready:!1,_reRun:!1,runCnt:0,timers:{},init:function(b){if(this.startTime=(new Date).getTime(),this.constructor._instance)throw new Error("Another instance already created. Use getInstance()");this.constructor._instance=this,a.extend(this.options,b||{}),e.log(this,"Init"),a.each(this.options.routes,function(b,d){a.each(d,function(a,d){c.add(d,b)})}),a(d).bind("locationChange",this.proxy("run"))},run:function(){if(this._ready===!1&&this.runCnt>0)return void(this._reRun=!0);var b,f=d.current().data,g=(new Date).getTime();if(void 0!==f&&f.skipRun===!0&&this.runCnt>0)return void e.log(this,"skipping run");this.runCnt++,this.runCnt>1&&(this.startTime=g),this._unready();var h=c.match();for(b in this._modules)void 0===h[b]&&this._unregisterModule(b);if(a.isEmptyObject(h))e.log(this,"Request unresolved ("+d.current().location+")"),this._setReady();else for(b in h)this._modulesToReady[b]=b,this.timers[b]=(new Date).getTime(),require([this._getModuleNameByClass(b)],this.proxy("_onLoadModule",b,h[b]))},_registerModule:function(b,c){if(void 0===this._modules[b]){var d=a.String.getObject(b,window,!0);if(d&&"function"==typeof d){var f=new d(c);e.log(f,"init"),this._modules[b]=f,e.log(this,b+" module registered")}else this.debug&&e.error('[App] Can not create instance of class "'+b+'" requested by path "'+this._getModuleNameByClass(b)+'"')}return this._modules[b]?!0:!1},_unregisterModule:function(a){return void 0===this._modules[a]?!1:(void 0!==this._modules[a].destruct&&(e.log(this._modules[a],"destruct"),this._modules[a].destruct()),void delete this._modules[a])},_onLoadModule:function(a,b){this._registerModule(a,b),void 0!==this._modules[a]&&void 0!==this._modules[a].run&&(this._modules[a]instanceof f?(this._modules[a].onReady(this.proxy("_onReadyModule",a)),this._modules[a].run(b)):(this._modules[a].run(b),this._onReadyModule(a)))},_onReadyModule:function(a){var b=(new Date).getTime();e.tLog(this._modules[a],a,"ready ["+(b-this.timers[a])+"ms]["+(b-this.startTime)+"ms]"),delete this._modulesToReady[a];var c,d=0;for(c in this._modulesToReady)this._modulesToReady.hasOwnProperty(c)&&d++;0==d&&this._setReady()},_unready:function(){app.Logger.log(this,"Drop ready state"),this._ready=!1,this._modulesToReady={},void 0!==window.whenReadyKillall&&a(window).whenReadyKillall()},_setReady:function(){var b=(new Date).getTime();for(e.tLog(this,"Ready ["+(b-this.startTime)+"ms]"),this._ready=!0,a([this]).trigger("ready");this.constructor._readyCallbacks.length>0;){var c=this.constructor._readyCallbacks.shift();void 0!==c.callback&&"function"==typeof c.callback&&(void 0===c.selector?c.callback():a(c.selector).whenReady(c.callback))}this._reRun!==!1&&(this._reRun=!1,this.run())},_getClassNameByModule:function(a){var b=a.split("/"),c=b.length;for(this.options.baseNamespace&&(c=b.unshift(this.options.baseNamespace));c--;)b[c]=b[c].charAt(0).toUpperCase()+b[c].slice(1);return b.join(".")},_getModuleNameByClass:function(a){this.options.baseNamespace&&(a=a.replace(this.options.baseNamespace+".",""));{var b=a.split(".");b.length}return b.join("/")}})}),function(){for(var a=["Logger","IModule","ADeferredModule","Hub","Observable","State","ModelList","AModel","AWatchedModel","ModelWatcher","Router","I18n","Core"],b=a.length,c=[],d={};b--;)c.unshift("yam/"+a[b]);define("yam",c,function(){for(var b=0;b<arguments.length;b++)d[a[b]]=arguments[b];return d})}();
//# sourceMappingURL=yam.min.js.map