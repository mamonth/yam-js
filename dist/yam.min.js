!function(a){if("function"==typeof define&&define.amd)define(["jquery","jquery-class","./Router","./State","./Logger","./IModule","./ADeferredModule"],a);else if("object"==typeof exports){var b=require("jquery"),c=require("jquery-class"),d=require("./Router"),e=require("./State"),f=require("./Logger"),g=require("./IModule"),h=require("./ADeferredModule");module.exports=a(b,c,d,e,f,g,h)}else a(b,b.Class,yam.Router,yam.State,yam.Logger,yam.IModule,yam.ADeferredModule)}(function(a,b,c,d,e,f,g){"use strict";return b.extend("yam.Core",{_instance:void 0,_readyCallbacks:[],getInstance:function(a){return this._instance||(this._instance=new this(a)),this._instance},ready:function(b,c){"function"==typeof b&&(c=b,b=void 0);var d=a.Deferred(),e=function(){d.resolve(this),"function"==typeof c&&c(this)};return this.getInstance()._ready?a(b).whenReady(e):this._readyCallbacks.push({selector:b,callback:e}),d.promise()}},{options:{routes:{},baseNamespace:"App"},_modules:{},_modulesToReady:{},_ready:!1,_reRun:!1,runCnt:0,timers:{},init:function(b){if(this.startTime=(new Date).getTime(),this.Class._instance)throw new Error("Another instance already created. Use getInstance()");this.Class._instance=this,a.extend(this.options,b||{}),e.log(this,"Init"),a.each(this.options.routes,function(b,d){a.each(d,function(a,d){c.add(d,b)})}),a(d).bind("locationChange",this.proxy("run"))},run:function(){if(this._ready===!1&&this.runCnt>0)return void(this._reRun=!0);var b,f=d.current().data,g=(new Date).getTime();if(void 0!==f&&f.skipRun===!0&&this.runCnt>0)return void e.log(this,"skipping run");this.runCnt++,this.runCnt>1&&(this.startTime=g),this._unready();var h=c.match();for(b in this._modules)void 0===h[b]&&this._unregisterModule(b);if(a.isEmptyObject(h))e.log(this,"Request unresolved ("+d.current().location+")"),this._setReady();else for(b in h)this._modulesToReady[b]=b,this.timers[b]=(new Date).getTime(),require([this._getModuleNameByClass(b)],this.proxy("_onLoadModule",b,h[b]))},_registerModule:function(b,c){if(void 0===this._modules[b]){var d=a.String.getObject(b,window,!0);if(d&&"function"==typeof d){var f=new d(c);e.log(f,"init"),this._modules[b]=f,e.log(this,b+" module registered")}else this.debug&&e.error('[App] Can not create instance of class "'+b+'" requested by path "'+this._getModuleNameByClass(b)+'"')}return this._modules[b]?!0:!1},_unregisterModule:function(a){return void 0===this._modules[a]?!1:(void 0!==this._modules[a].destruct&&(e.log(this._modules[a],"destruct"),this._modules[a].destruct()),void delete this._modules[a])},_onLoadModule:function(a,b){this._registerModule(a,b),void 0!==this._modules[a]&&void 0!==this._modules[a].run&&(this._modules[a]instanceof g?(this._modules[a].onReady(this.proxy("_onReadyModule",a)),this._modules[a].run(b)):(this._modules[a].run(b),this._onReadyModule(a)))},_onReadyModule:function(a){var b=(new Date).getTime();e.tLog(this._modules[a],a,"ready ["+(b-this.timers[a])+"ms]["+(b-this.startTime)+"ms]"),delete this._modulesToReady[a];var c,d=0;for(c in this._modulesToReady)this._modulesToReady.hasOwnProperty(c)&&d++;0==d&&this._setReady()},_unready:function(){app.Logger.log(this,"Drop ready state"),this._ready=!1,this._modulesToReady={},void 0!==window.whenReadyKillall&&a(window).whenReadyKillall()},_setReady:function(){var b=(new Date).getTime();for(e.tLog(this,"Ready ["+(b-this.startTime)+"ms]"),this._ready=!0,a([this]).trigger("ready");this.Class._readyCallbacks.length>0;){var c=this.Class._readyCallbacks.shift();void 0!==c.callback&&"function"==typeof c.callback&&(void 0===c.selector?c.callback():a(c.selector).whenReady(c.callback))}this._reRun!==!1&&(this._reRun=!1,this.run())},_getClassNameByModule:function(a){var b=a.split("/"),c=b.length;for(this.options.baseNamespace&&(c=b.unshift(this.options.baseNamespace));c--;)b[c]=b[c].charAt(0).toUpperCase()+b[c].slice(1);return b.join(".")},_getModuleNameByClass:function(a){this.options.baseNamespace&&(a=a.replace(this.options.baseNamespace+".",""));{var b=a.split(".");b.length}return b.join("/")}}),yam.Core}),function(a){if("function"==typeof define&&define.amd)define(["jquery-class"],a);else if("object"==typeof exports){var b=require("jquery-class");module.exports=a(b)}else a(jQuery.Class)}(function(a){"use strict";var b=function(){},c="undefined"!=typeof navigator&&-1!=navigator.userAgent.indexOf("MSIE"),d=console?console:{log:b,debug:b,info:b,warn:b,error:b};return a.extend("yam.Logger",{NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4,LOG:5,level:1,log:function(){this.level>=this.LOG&&this._echo(arguments,"log")},debug:function(){this.level>=this.DEBUG&&this._echo(arguments,"debug")},info:function(){this.level>=this.INFO&&this._echo(arguments,"info")},warn:function(){this.level>=this.WARN&&this._echo(arguments,"warn")},error:function(){this.level>=this.ERROR&&this._echo(arguments,"error")},_parseArgs:function(){var a=Array.prototype.slice.call(arguments[0]),b=a[0]instanceof jQuery.Class;return[b?"["+a[0].constructor.fullName+"]":a[0]].concat(a.slice(1))},_echo:function(a,b){var a=Logger._parseArgs(a);c?d[b](a.join(" ")):d[b].apply(console,a)}},{})}),function(a){if("function"==typeof define&&define.amd)define(["jquery","jquery-class","./Logger"],a);else if("object"==typeof exports){var b=require("jquery-class"),c=require("./Logger"),d=require("jquery");module.exports=a(d,b,c)}else a(d,d.Class,yam.Logger)}(function(a,b,c){"use strict";return b.extend("yam.Hub",{_nSpace:".yam",_domNode:a("<i/>"),stack:{},channels:{},pub:function(a,b,d){b=b||{},d=d===!0?!0:!1,"undefined"==typeof this.stack[a]&&(this.stack[a]=[]),this.channels[a]||d?this._pub(a,b):(this.stack[a].push(b),c.warn(this,'Push channel "'+a+'" to stack',b))},_pub:function(a,b){c.info(this,'Publish to channel "'+a+'"',b),this._domNode.trigger.apply(this._domNode,arguments)},sub:function(b,d){function e(a,b){return d.call(this,b,a)}if(this.channels[b]=!0,c.info(this,'Subscribed to channel "'+b+'"'),e.guid=d.guid=d.guid||(a.guid?a.guid++:a.event.guid++),this._domNode.bind(b+this._nSpace,e),this.stack[b]){for(var f in this.stack[b])c.warn(this,'get channel "'+b+'" from stack',f,this.stack[b]),this._pub(b,this.stack[b][f]);delete this.stack[b]}},unsub:function(a,b){c.info(this,'Unsubscribed from channel "'+a+'"'),void 0===b?this._domNode.unbind(a+this._nSpace):"function"==typeof b?this._domNode.unbind(a+this._nSpace,b):"object"==typeof b&&void 0!==b.type&&this._domNode.unbind(b)}},{}),yam.Hub}),function(a){if("function"==typeof define&&define.amd)define(["jquery","jquery-class"],a);else if("object"==typeof exports){var b=require("jquery-class"),c=require("jquery");module.exports=a(c,b)}else a(c,c.Class)}(function(a,b){"use strict";return b.extend("yam.State",{_stack:[],_currentKey:0,current:function(){var a;return a=void 0!==this._stack[this._currentKey]?this._stack[this._currentKey]:new this},push:function(b,c,d){var e=b instanceof this?b:new this(b,c,d);this._stack.length&&this._currentKey++,this._stack.splice(this._currentKey),this._stack.push(e),a(this).trigger("locationChange",e).trigger("push",e)},replace:function(b,c,d){var e=b instanceof this?b:new this(b,c,d);this._stack[this._currentKey]=e,a(this).trigger("locationChange",e).trigger("replace",e)},back:function(b){b=!b||isNaN(b)?1:Math.min(b,this._currentKey),this._currentKey&&(this._currentKey=this._currentKey-b,a(this).trigger("locationChange",this.current()).trigger("back",this.current()))},forward:function(b){b=!b||isNaN(b)?1:Math.min(b,this._stack.length-(this._currentKey+1)),this._currentKey<this._stack.length&&(this._currentKey=this._currentKey+b,a(this).trigger("locationChange",this.current()),a(this).trigger("forward",this.current()))}},{location:"",title:"",data:null,init:function(a,b,c){this.location=a,this.data=b||{},this.title=c||""}}),yam.State}),function(a){if("function"==typeof define&&define.amd)define(["jquery","jquery-class","./Logger","./State"],a);else if("object"==typeof exports){var b=require("jquery-class"),c=require("./Logger"),d=require("./State"),e=require("jquery");module.exports=a(e,b,c,d)}else a(e,e.Class,yam.Logger,yam.State)}(function(a,b,c,d){"use strict";return b.extend("yam.Route",{_rules:[],add:function(a,b){this._rules.push(new this(a,b))},match:function(a){a||(a=d.current().location);for(var b={},c=this._rules.length,e=0;c>e;e++)if(void 0===b[this._rules[e].name]){var f=this._rules[e].match(a);f!==!1&&(b[this._rules[e].name]=f)}return b},getParams:function(){for(var a,b={},c=this.getParamsString().split("&"),d=c.length;d--;)if(c[d]&&(a=c[d].split("="),a[0])){var e=a[0].indexOf("["),f=a[0].indexOf("]");if(e>0&&f>0){var g=a[0].substr(0,e);if("]"==a[0].charAt(e+1))b[g]||(b[g]=[]),b[g].push(a[1]);else{b[g]||(b[g]={});var h=a[0].substr(e+1,f-e-1);b[g][h]=a[1]}}else b[a[0]]=a[1]||""}return b},getParamsString:function(){var a=window.History.getState().url,b=a.indexOf("?");return b>0&&b+1<a.length?a.slice(b+1):""},extractChunkURI:function(a){var b=d.current().location,c=void 0;if(!isNaN(a)&&"string"==typeof b&&b.length>0&&b.indexOf("/")>=0){var e=b.split("/");e.length>=parseInt(a)&&(c=e[parseInt(a)])}return c},buildParamsString:function(b,c,d){var e=[],f=/\[\]$/,g=/%20/g,h=function(a,b){return b?a:encodeURIComponent(a)},i=function(b,c,d){a.isFunction(c)||(("undefined"==typeof c||null===c)&&(c=""),e[e.length]=h(b,d)+"="+h(c))},j=function(a,b,c,e,g){if(jQuery.isArray(b))b.forEach(function(b,i){c||f.test(a)?e(a,b):j(h(a,g)+"["+(d||"object"!=typeof b&&!jQuery.isArray(b)?"":i)+"]",b,c,e,!0)});else if(null!==b&&"object"==typeof b)for(var i in b){if(i.match(/jQuery[0-9]+/gi))return;j(h(a,g)+"["+h(i)+"]",b[i],c,e,!0)}else e(a,b,g)};if(void 0===c&&(c=a.ajaxSettings.traditional),a.isArray(b)||b.jquery&&!a.isPlainObject(b))a.each(b,function(){i(this.name,this.value)});else for(var k in b)j(k,b[k],c,i);return e.join("&").replace(g,"+")}},{name:null,rule:null,init:function(a,b){this.name=b,this.rule=a},match:function(a){var b,c,d=!1;if(this.rule instanceof RegExp){if(b=this.rule.exec(a))for(d=[],c=1;c<=b.length;c++)void 0!==b[c]&&d.push(b[c])}else a==this.rule&&(d=[]);return d}}),yam.Route}),function(a){if("function"==typeof define&&define.amd)define(["jquery-class"],a);else if("object"==typeof exports){var b=require("jquery-class");module.exports=a(b)}else a(jQuery.Class)}(function(a){"use strict";a.extend("app.Observable",{_attachedObservers:{},attachObserver:function(a,b){arguments.length<2&&(b=a,a="**WILDCARD**"),(b instanceof Object||b instanceof Function)&&(this._attachedObservers[a]||(this._attachedObservers[a]=[]),this._attachedObservers[a].push(b))},detachObserver:function(a,b){arguments.length<2&&(b=a,a=null);for(var c in this._attachedObservers)if(null===a||c===a)for(var d=this._attachedObservers[c].length;d--;)this._attachedObservers[c][d]===b&&this._attachedObservers[c].splice(d,1)},notify:function(a){if(this._attachedObservers[a]&&this._attachedObservers[a].length){for(var b=this._attachedObservers[a].length;b--;)this._notifyObserver(a,this._attachedObservers[i]);for(b=this._attachedObservers["**WILDCARD**"].length;b--;)this._notifyObserver(a,this._attachedObservers[i])}},_notifyObserver:function(a,b){b instanceof Function?b(a,this):b.update instanceof Function&&b.update(a,this)}})}),function(a){if("function"==typeof define&&define.amd)define(["./Observable"],a);else if("object"==typeof exports){var b=require("./Observable");module.exports=a(b)}else a(yam.Observable)}(function(a){"use strict";return a.extend("yam.AModel",{properties:[],setup:function(a,b,c,d){for(var e in d)this._createGetSetFor(e)},getIdentity:function(){return"id"},get:function(){var a=$.Deferred();return a.promise()},getList:function(){var a=$.Deferred();return a.promise()},_getMethodEnding:function(a){return a.charAt(0).toUpperCase()+a.substr(1,a.length-1)},_createGetSetFor:function(a){if("function"!=typeof this.prototype[a]&&"_"!=a.charAt(0)){var b=this._getMethodEnding(a);void 0===this.prototype["get"+b]&&(this.prototype["get"+b]=function(){return this[a]}),void 0===this.prototype["set"+b]&&(this.prototype["set"+b]=function(b){return this._set(a,b)}),this.properties.push(a)}},factory:function(a){var b=new this;return a instanceof Object&&b.fill(a),b}},{id:void 0,_modifiedProperties:void 0,init:function(a){this.fill(a)},fill:function(a){for(var b in a){var c="set"+this.Class._getMethodEnding(b);void 0!==this[c]&&"function"==typeof this[c]&&this[c](a[b])}},getIdentityValue:function(){return void 0!==this[this.Class.getIdentity()]?this[this.Class.getIdentity()]:void 0},_triggerProperty:function(a,b,c){$([this]).triggerHandler("propertyChange",{path:a,value:b,oldValue:c})},_set:function(a,b){var c=this[a];return this[a]=b,void 0!==c&&(this._modifiedProperties instanceof Array?this._modifiedProperties.push(a):this._modifiedProperties=[a]),this._triggerProperty(a,b,c),!0},getModifiedProperties:function(){return this._modifiedProperties instanceof Array?this._modifiedProperties:[]},propertiesData:function(){for(var a,b={},c=this.Class.properties.length;c>=0;--c)a=this.Class.properties[c],void 0!==a&&this.hasOwnProperty(a)&&(b[a]=this[a]);return b}}),yam.AModel}),define(["./Observable","./ModelWatcher","./ModelList","./AModel"],function(){"use strict";return app.AModel.extend("app.AWatchedModel",{create:function(a){return a instanceof Object&&void 0!==a.id?app.ModelWatcher.has(this,a.id)?app.ModelWatcher.get(this,a.id):new this(a):void 0},update:function(a){if(a instanceof Object&&void 0!==a.id&&app.ModelWatcher.has(this,a.id)){var b=app.ModelWatcher.get(this,a.id);for(var c in a){var d="set"+b.Class._getMethodEnding(c);void 0!==b[d]&&"function"==typeof b[d]&&b[d](a[c])}}},factory:function(a){var b=app.ModelWatcher.has(this,a.id)?app.ModelWatcher.get(this,a.id):new this;return a instanceof Object&&b.fill(a),b}},{init:function(a){this._super(a),void 0!==this[this.Class.getIdentity()]&&app.ModelWatcher.register(this)}}),app.AWatchedModel}),define(["./Observable"],function(){"use strict";app.Observable.extend("app.ModelList",{_classDef:void 0,_collection:void 0,length:0,_proxyed:void 0,init:function(a,b){if(this._classDef=a,this._collection=[],this._proxyed={},this._proxyed.ojectChange=this.proxy(function(a,b){return a.stopPropagation(),$([this,this._collection]).triggerHandler("objectChange",$.extend(b,{targetModel:a.target})),!1}),void 0!==b&&b instanceof Array)for(var c=b.length,d=0;c>d;d++)b[d]instanceof app.AModel?this.push(b[d]):b[d]instanceof Object&&!(b[d]instanceof app.AModel)&&this.push(void 0!==this._classDef.create?this._classDef.create(b[d]):new this._classDef(b[d]))},push:function(a){this._collection.push(a),$([a]).bind("propertyChange",this._proxyed.ojectChange),this.length++,this._trigger({change:"insert",index:this._collection.length-1,items:[a]})},unshift:function(a){this._collection.unshift(a),$([a]).bind("propertyChange",this._proxyed.ojectChange),this.length++,this._trigger({change:"insert",index:0,items:[a]})},pop:function(){var a=this._collection.length-1,b=this._collection[a];return this._collection.splice(a,1),this.length=this._collection.length,this._trigger({change:"remove",index:a,items:[b]}),$([b]).unbind("propertyChange",this._proxyed.ojectChange),b},last:function(){return this._collection[this._collection.length-1]},getById:function(a){var b=this._getKeyBy(this._classDef.getIdentity(),a);return b.length?this._collection[b[0]]:null},get:function(a){return this._collection[a]},getIds:function(){for(var a=this._collection.length,b=[];a--;)b.push(this._collection[a][this._classDef.getIdentity()]);return b},remove:function(a){var b=this._getKeyBy(a.Class.getIdentity(),a.getIdentityValue()),c=b.length;if(c)for(;c--;)this._collection.splice(b[c],1),this._trigger({change:"remove",index:b[c],items:[a]}),this.length--;return $([a]).unbind("propertyChange",this._proxyed.ojectChange),c},splice:function(a,b){b=b||this.length;var c=a>0?a-1:this._collection.length-b,d=this._collection.splice(a,b);this.length=this._collection.length,this._trigger({change:"remove",index:c,items:d})},filterBy:function(a,b){for(var c=this._getKeyBy(a,b),d=c.length,e=new this.Class(this._classDef),f=0;d>f;f++)e.push(this._collection[d]);return e},each:function(a){if("function"!=typeof a)throw new Error("Invalid argument: callback must be a function");for(var b=this._collection.length,c=0;b>c;c++)a(this._collection[c])},_getKeyBy:function(a,b){for(var c=this._collection.length,d=[],e=0;c>e;e++)void 0!==this._collection[e]&&void 0!==this._collection[e][a]&&this._collection[e][a]===b&&d.push(e);return d},_trigger:function(a){$([this._collection]).triggerHandler("arrayChange",a)},getArray:function(){return this._collection},clear:function(){this._collection.length>0&&$(this._collection).unbind("propertyChange",this._proxyed.ojectChange),this._collection.length=0,this.length=this._collection.length,this._trigger({change:"remove",items:this._collection})}})}),function(a){if("function"==typeof define&&define.amd)define(["jquery-class"],a);else if("object"==typeof exports){var b=require("jquery-class");module.exports=a(b)}else a(jQuery.Class)}(function(a){"use strict";return a.extend("yam.IModule",{init:function(){},run:function(){throw new Error(this.constructor.fullName+": method run must be implemented.")},destruct:function(){throw new Error(this.constructor.fullName+": method destruct must be implemented")}}),yam.IModule}),function(a){if("function"==typeof define&&define.amd)define(["./IModule"],a);else if("object"==typeof exports){var b=require("./IModule");module.exports=a(b)}else a(yam.IModule)}(function(a){"use strict";return a.extend("yam.ADeferredModule",{_readyCallbacks:null,setup:function(){this._readyCallbacks=[]},onReady:function(a,b){if(b=void 0===b?!0:b,"function"!=typeof a)throw new Error("callback must be function");this._readyCallbacks.push({runOnce:b,callback:a})},setReady:function(){for(var a=this._readyCallbacks.length;a--;)void 0!==this._readyCallbacks[a].callback&&"function"==typeof this._readyCallbacks[a].callback&&this._readyCallbacks[a].callback(),this._readyCallbacks[a].runOnce!==!1&&this._readyCallbacks.splice(a,1)}}),yam.ADeferredModule}),define(["./Logger"],function(){app.I18n=function(a,b,c){return c=c||!1,b=app.I18n.get(a,b,!1),c?app.I18n.ucfirst(b):b},app.I18n.storage={},app.I18n.dictMonths=["january","february","march","april","may","june","july","august","september","october","november","december"],app.I18n.dictDays=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],app.I18n.register=function(a,b){this.storage[a]=b},app.I18n.ucfirst=function(a){var b=a.charAt(0).toUpperCase();return b+a.substr(1,a.length-1)},app.I18n.monthByNum=function(a){return a>app.I18n.dictMonths.length-1?!1:app.I18n.dictMonths[a]},app.I18n.dayByNum=function(a){return a>app.I18n.dictDays.length-1?!1:app.I18n.dictDays[a]},app.I18n.formByNum=function(a,b,c){c=app.I18n._get(b,c,!0);var d=[2,0,1,1,1,2],e=a%100,f=Math.min(e>4&&20>e?2:d[Math.min(e%10,5)],c.length-1);return c[f]},app.I18n.getForm=function(a,b,c){return b=app.I18n._get(a,b,!0),b[Math.min(c,b.length)]},app.I18n._get=function(a,b,c){c=c||!1;var d=b+"";return void 0!==app.I18n.storage[a]&&void 0!==app.I18n.storage[a][b]&&(d=app.I18n.storage[a][b]),!c||d instanceof Array||(d=[d]),!c&&d instanceof Array&&(d=d.length?d[0]:b),d},app.I18n.get=function(a,b){var c=b+"";if(void 0!==app.I18n.storage[a]&&void 0!==app.I18n.storage[a][b]&&(c=app.I18n.storage[a][b]),c){var d=Array.prototype.slice.call(arguments).splice(2);d.unshift(c),c=app.I18n.format.apply(app.I18n,d)}return c},app.I18n.format=function(a){var b=Array.prototype.slice.call(arguments).splice(1),a="undefined"!=typeof a.substring?a:"";return a=a.replace(/{%(\d+)}/g,function(a,c){return c--,"undefined"!=typeof b[c]?b[c]:a}),a=a.replace(/\[(\w+)(:([^\]]+))?\]/g,function(a,c,d,e){var e=e?e.split("|"):[],f="_"+c+"Tag",g=!1;if("function"!=typeof app.I18n[f])throw new Error('Unsupported tag"'+c+'"');return g=app.I18n[f](b[0],e),g?g:""})},app.I18n._countTag=function(a,b){var c=[2,0,1,1,1,2],d=a%100,e=Math.min(d>4&&20>d?2:c[Math.min(d%10,5)],b.length-1);return b[e]}});
//# sourceMappingURL=yam.min.js.map